# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Architecture Overview

Synevyr is a full-stack web application with a Flask backend and Next.js frontend. The application handles customer data analysis with real-time processing capabilities using Celery workers.

**Core Components:**
- **Backend**: Flask application with SQLAlchemy, Celery for background tasks, MySQL database
- **Frontend**: Next.js 15 with React 19, TypeScript, TailwindCSS
- **Database**: MySQL with custom data models for customer analysis, orders, and leads
- **Task Queue**: Celery with Redis for background data processing
- **Data Generation**: Synthetic data generators for development/testing

## Development Commands

### Initial Setup
```bash
# First-time setup (creates venv, installs deps, seeds database)
python3 run_me_first.py

# Restart all services after initial setup
python3 autostart.py
```

### Backend Development
```bash
cd backend
source ../.synevyr_venv/bin/activate
python run.py  # Starts Flask server on port 2001
```

### Frontend Development  
```bash
cd frontend
npm run dev    # Starts Next.js dev server on port 2000
npm run build  # Build for production
npm run lint   # Lint the frontend code
```

### Background Services
```bash
# Start Celery worker (from backend directory)
source ../.synevyr_venv/bin/activate
celery -A celery_app.celery worker --loglevel=INFO -E

# Start Celery beat scheduler (from backend directory)  
source ../.synevyr_venv/bin/activate
celery -A celery_app.celery beat --loglevel=INFO
```

### Testing
```bash
# Backend testing (from backend directory)
source ../.synevyr_venv/bin/activate
pytest

# Frontend testing
cd frontend  
npm test
```

## Project Structure

### Backend Architecture (`backend/`)
- **`app/__init__.py`** - Flask app factory with CORS, middleware, blueprint registration
- **`app/core/config.py`** - Configuration classes for development/production environments
- **`app/endpoints/`** - API route blueprints (auth, data_sources, tasks, general, open_data)
- **`app/models/`** - SQLAlchemy database models
- **`app/tasks/`** - Celery background task definitions
- **`app/utils/`** - Utility functions including database initialization and logging
- **`run.py`** - Main Flask application entry point
- **`celery_app.py`** - Celery worker/beat configuration

### Frontend Architecture (`frontend/`)
- Next.js 15 application with App Router
- React 19 with TypeScript
- TailwindCSS for styling
- Real-time communication via Socket.IO
- Chart.js for data visualization

### Database Schema
Main tables include:
- `user_customers` - Customer information and activity status
- `wc_orders` - WooCommerce order data with billing/shipping details  
- `meta_leads` - Meta/Facebook advertising lead data
- `customer_analysis` - Unified customer analysis with spend metrics
- `cx_stats` - Customer statistics and lifetime value calculations

### Data Generators (`generators/`)
Synthetic data generation for development:
- `generator.py` - Main seeding orchestrator
- `make_me_a_person.py` - Customer data generation
- `make_me_wc_orders.py` - Order data generation  
- `make_me_meta_leads.py` - Lead data generation
- `location_repo.py` - Geographic data repository

## Environment Configuration

### Required Environment Files
- **`keys.env`** - Main environment configuration (auto-generated by run_me_first.py)
- **`frontend/.env.local`** - Frontend development environment
- **`frontend/.env.production`** - Frontend production environment

### Key Environment Variables
- `FLASK_ENV` - development/production
- `DATABASE` - Database name (db_synevyr)
- `DEV_DB_*` - Local MySQL connection parameters
- `FLASK_SESSION_KEY` - Session encryption key
- `NEXT_PUBLIC_API_BASE_URL` - Frontend API endpoint
- `NEXT_PUBLIC_SOCKET_URL` - WebSocket connection URL

## Development Workflow

1. Use `python3 run_me_first.py` for first-time setup
2. Use `python3 autostart.py` for subsequent development sessions (macOS only)
3. Both backend (port 2001) and frontend (port 2000) run concurrently
4. Celery workers handle background data processing tasks
5. Database seeding creates realistic synthetic data for development

## Prerequisites

- Python 3.x with venv support
- Node.js and npm
- MySQL server (configured with root password "Synevyr_SQL_PWD")  
- Redis server (for Celery task queue)
- macOS (for automated terminal management via autostart.py)